\section{\lr{Matrix multiplication}}
احتمالا دلیل
\lr{segmentaion fault}
باید
\lr{stack overflow}
باشد. از آنجا که حداکثر سایز استک بر روی لینوکس برابر ۸ مگابایت است پس از
$N = 800$
شروع می‌کنیم. با این کار برای ذخیره سازی ماتریس‌ها
$3 \times 800 \times 800 \times 4 = 7680000$
بایت فضا نیاز داریم. اما در ابتدا من متوجه شدم که هر چه قدر که
$N$
را زیاد کنم اتفاقی نمی‌افتد و به
\lr{segfault}
نمی‌خورم! همچنین زمان اجرای حلقه‌ی مربوط به ماتریس
$C$
همیشه در اردر میکروثانیه تمام می‌شد که فوق العاده مشکوک بود. با ور رفتن به کد متوجه شدم که در صورتی که
برنامه را با
\codeword{-O3}
کامپایل کنم حلقه‌ی حساب کردن ضرب ماتریس به صورت کلی حذف می‌شود. پس در این سوال نیز من پرچم
\codeword{-O3}
را بر می‌دارم. می‌توانستم به جای برداشتن
\codeword{-O3}
صرفا یکی از درایه‌های ماتریس‌را نیز چاپ کنم ولی با توجه به
\lr{GodBolt}
متوجه شدم که خود
\lr{gcc}
نیز سعی می‌کند که به کمک دستورات
\lr{SIMD}
حلقه را
\lr{optimize}
کند. پس صرفا پرچم
\lr{optimize}
را برداشتم.

حال حداکثر مقدار
$N$
را تست می‌کنیم. متوجه می‌شویم که با
$N = 800$
برنامه به درستی اجرا می‌شود ولی با
$N = 900$
برنامه کرش می‌کند. پس قرار می‌دهیم
$N = 800$.

حال کد‌های خواسته شده را می‌نویسیم. تمامی کد‌های من در فولدر
\lr{codes}
در کنار تمرین موجود است. نتایج زمان‌های اجرا به صورت زیر است:
\begin{latin}
\centering
\begin{tabular}{|c|c|c|c|c|c|}
    \hline
    Thread \# & 1 & 4 & 8 & 16 & 64\\
    \hline
    Inner & 1324.31 & 355.35 & 519.504 & 546.336 & 595.245 \\
    \hline
    Outer & 1328.48 & 353.133 & 502.793 & 513.073 & 508.869 \\
    \hline
\end{tabular}
\end{latin}
همان طور که مشخص است کمی مدل
\lr{outer}
در زمانی که بیشتر از یک ترد‌ داریم بهتر است. به نظر من دلیل این موضوع
\lr{cache line}ها
هستند. بدین منظور که اگر هر سطر را به یک ترد بسپاریم، آن سطر فقط در همان هسته وجود دارد و این باعث
می‌شود که
\lr{false sharing}
رخ ندهد. از طرفی متوجه می‌شویم که بعد از 4 ترد زمان اجرای برنامه افزایش می‌یابد. این دلیل
به خاطر این است که پردازنده‌ی من ۴ هسته و ۸ ترد دارد. پس به صورت
\lr{effective}
۴ \lr{alu}
دارد و در نتیجه ۴ کار را به بهترین نحو ممکن انجام می‌دهد. اما زمانی که تعداد ترد‌ها بیشتر می‌شود به خاطر
\lr{context switch}
زمان اجرای برنامه بیشتر می‌شود.